<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JUI Playground</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
    
        html, body {
            height: 100%;
            margin: 0;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        #main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            transition: margin-left 0.3s;
            position: relative; 
			z-index: 1; /* Metti il contenuto sotto la sidebar */
			
        }

        #preview-container {
            width: 100%;
            height: 80vh; 
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            padding: 10px;
            border-radius: 5px;
            background-color: #f5f5f5;
        }
        
	    /* Stile per il Code Editor */
		#code-editor {
		    border: 1px solid #ddd;
		    height: 80vh; 
		    background-color: #f9f9f9;
		    #padding: 10px;
		}
		
		/* Pannello per le icone */
		#icon-panel {
		    width: 40px; /* Larghezza fissa per visualizzare solo le icone */
		    background-color: #343a40;
		    height: 80vh;
		    color: white;
		    padding: 10px 0;
		    display: flex;
		    flex-direction: column;
		}
		
		/* Stile per i pulsanti delle icone */
		.btn-icon {
		    background-color: transparent;
		    border: none;
		    color: white;
		    margin-bottom: 15px;
		    font-size: 1.5rem;
		    cursor: pointer;
		}
		
		.btn-icon:hover {
		    color: #33ff33; /* Cambia colore al passaggio del mouse */
		}
	    
	    

        #preview-container {
            width: 100%;
            height: 80vh; /* Occupa il 65% dell'altezza della finestra */
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Pannello console */
		#console {
		    position: fixed;
		    bottom: 40px; /* Posizionato sopra il footer */
		    left: 0;
		    width: 100%; /* Occupa tutta la larghezza */
		    white-space: pre-wrap; /* Mantiene i ritorni a capo e gli spazi */
		    background-color: #1e1e1e;
		    color: #33ff33;
		    font-family: monospace;
		    padding: 10px;
		    height: 150px;
		    overflow-y: auto; /* Scorrimento solo all'interno */
		    border-top: 2px solid #333;
		    display: none; /* La console è nascosta al caricamento */
		    z-index: 999; /* Sopra altri elementi */
		}
		
		/* Footer */
		footer {
		    background-color: #282c34;
		    color: white;
		    text-align: center;
		    padding: 5px 15px;
		    display: flex;
		    justify-content: space-between;
		    font-size: 0.9rem;
		    position: fixed;
		    bottom: 0; /* Sempre nella parte bassa dello schermo */
		    left: 0;
		    width: 100%;
		    height: 40px; /* Altezza del footer */
		    z-index: 1000; /* Sopra il contenuto principale ma sotto la console */
		}
		
		/* Link del footer per visualizzare la console */
		footer a {
		    color: #33ff33;
		    cursor: pointer;
		}
		
		/* Mostra il pannello console quando attivo */
		#console.active {
		    display: block;
		}


        .toggle-link {
            color: #007bff;
            cursor: pointer;
            text-decoration: underline;
        }

        /* Header */
		header {
		    background-color: #343a40;
		    color: white;
		    padding: 10px 15px;
		    display: flex;
		    align-items: center;
		    position: fixed;
		    top: 0;
		    left: 0;
		    width: 100%;
		    z-index: 1001; /* Assicurati che l'header sia sopra la sidebar */
		}
		
		header h1 {
		    font-size: 1.25rem;
		    margin-left: 15px;
		}
		
		.fa-bars {
		    cursor: pointer;
		    font-size: 1.5rem;
		}
		
		/* Sidebar Collassabile */
		#sidebar {
		    height: 100%;
		    width: 250px;
		    position: fixed;
		    top: 50px; /* Sotto l'header */
		    left: -250px; /* Sidebar nascosta fuori schermo */
		    background-color: #495057; 
		    color: white;
		    padding-top: 20px;
		    overflow-x: hidden;
		    transition: left 0.3s;
		    z-index: 1000; /* Sotto l'header */
		}
		
		#sidebar.active {
		    left: 0; /* Sidebar visibile sovrapponendosi al contenuto, ma sotto l'header */
		}
		
		#sidebar a {
		    padding: 10px 15px;
		    text-decoration: none;
		    font-size: 1.1rem;
		    color: white;
		    display: block;
		}
		
		#sidebar a:hover {
		    background-color: #575757;
		}
		
				/* Overlay per oscurare il contenuto sottostante */
		#overlay {
		    position: fixed;
		    top: 0;
		    left: 0;
		    width: 100%;
		    height: 100%;
		    background-color: rgba(0, 0, 0, 0.5); /* Opacità */
		    z-index: 999; /* Sotto la sidebar */
		    display: none;
		}
		
		#overlay.active {
		    display: block;
		}

		
		/* Contenuto principale */
		#main-content {
		    margin-left: 0;
		    padding: 80px 20px 20px 20px; /* Aggiunto padding top per non essere coperto dall'header */
		    transition: margin-left 0.3s;
		}
		
		#main-content.sidebar-collapsed {
		    margin-left: 250px; /* Sposta il contenuto quando la sidebar è aperta */
		}
        
    </style>
</head>

<body>

	<!-- Sidebar -->
	<div id="sidebar">
	    <a href="#"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
	    <a href="#"><i class="fas fa-folder"></i> Projects</a>
	    <a href="#"><i class="fas fa-cog"></i> Settings</a>
	    <a href="#"><i class="fas fa-question-circle"></i> Help</a>
	</div>

	
	<!-- Overlay (facoltativo, per oscurare il contenuto) -->
	<div id="overlay"></div>

	<!-- Header -->
	<header>
		<a href="javascript:void(0)" class="close-btn" onclick="toggleSidebar()">
	        <i class="fas fa-bars"></i> <!-- Icona di chiusura -->
	    </a>
	    <h1>JUI Playground</h1>
	</header>
	
	<div id="main-content" class="container-fluid">
	        <div class="row">
	        	
	           <div class="col-md-6">
	           
			    <div class="d-flex justify-content-between align-items-center mb-2">
			        <!-- Sezione a sinistra: Select Example -->
			        <div class="d-flex align-items-center flex-grow-1">
			            <label for="example-selector" class="me-2 mb-0" style="white-space: nowrap;">Select Example:</label>
			            <select id="example-selector" class="form-select form-select-sm flex-grow-1">
			                <!-- Opzioni da inserire qui -->
			            </select>
			        </div>
			
			        <!-- Sezione a destra: Pulsanti Run e Save 
			        <div class="d-flex justify-content-end ms-3">
			            <button id="run-btn" class="btn btn-primary btn-sm me-2">
			                <i class="fas fa-play"></i> Run 
			            </button>
			            <button id="save-btn" class="btn btn-secondary btn-sm">
			                <i class="fas fa-save"></i> Save 
			            </button>
			        </div>
			        -->
			    </div>
			    
				<div class="d-flex">
				    
				    <div id="icon-panel" class="d-flex flex-column justify-content-start align-items-center">
			            
				        <button id="run-btn" class="btn btn-icon">
				            <i class="fas fa-play"></i>
				        </button>
				        <button id="save-btn" class="btn btn-icon">
				            <i class="fas fa-save"></i>
				        </button>
				        <!--
				        <button class="btn btn-icon">
				            <i class="fas fa-cog"></i>
				        </button>
				        -->
				    </div>
				
				    <div id="code-editor" class="flex-grow-1">
				    </div>
				</div>
								
			</div>
				           
	            
	            <div class="col-md-6">
	                <div class="d-flex justify-content-between align-items-center mb-2">
	                    <input type="text" id="url-input" class="form-control-sm w-75" placeholder="Enter URL...">
	                    <button id="open-browser-btn" class="btn btn-primary btn-sm me-2">
			                <i class="fa fa-window-maximize" aria-hidden="true"></i> Open 
			            </button>
	                </div>
	                <iframe id="preview-container" title="Website Preview"></iframe>
	            </div>
	        </div>
	    
	</div>
	
	
	
	<footer class="mt-auto">
	    <span id="toggle-console" class="toggle-link">
	    	<a href="javascript:void(0)" class="close-btn" onclick="toggleConsole()">
	        	<i class="fas fa-terminal"></i>
	    	</a>
	    </span>
	    <span>maurizio.farina@gmail.com</span>
	</footer>
	<div id="console" class="container-fluid mt-3">
	</div>
	

	<!-- Bootstrap JS, Popper.js, and dependencies -->
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.23.0/min/vs/loader.min.js"></script>
  
	<script>
	    let currentFileName = ""; // Variabile per mantenere il nome del file selezionato
		
	    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.23.0/min/vs' } });
	    require(['vs/editor/editor.main'], function () {
	      window.editor = monaco.editor.create(document.getElementById('code-editor'), {
	        value: '',
	        language: 'java',
	        automaticLayout: true,
	        theme: "vs-dark",
	        lineNumbers: "on",
			minimap: { enabled: false }
			
	      });
	    });
	    
	    let optionsLoaded = false;
	    
	    function loadExamples() {
	      if (optionsLoaded) return;
	       
	      fetch('/api/examples')
	        .then(response => response.json())
	        .then(data => {
	          const exampleList = document.getElementById('example-selector');
	          exampleList.innerHTML = ""; // Pulisci l'elenco degli esempi prima di aggiornare
	          
	          const optionDefault = document.createElement('option');
              optionDefault.textContent = "choose a file";
              optionDefault.value = "";
              exampleList.appendChild(optionDefault);
	            
	          data.forEach(example => {
	            const option = document.createElement('option');
	            option.textContent = example.name;
	            option.value = example.name;
	            exampleList.appendChild(option);
	          });
	        });
	        
	        optionsLoaded = true;
	    }
	    document.getElementById('example-selector').addEventListener('click', loadExamples);
	    
	    function loadExampleCode(fileName) {
	      fetch(`/api/examples/${fileName}`)
	        .then(response => response.text())
	        .then(code => {
	          editor.setValue(code);
	          currentFileName = fileName; 
	          runButton.disabled = false; 
	        });
	    }
	    
	    	    
	    
	    
	    function setDraftCode() {
	    	var code = `package src.examples;

import static com.jui.JuiApp.jui;

public class JUIExample {
	
	public static void main(String... args) throws FileNotFoundException, IOException {
		
		jui.input.header("Input Example", "blue");
    	
		//write here JUI code
		jui.input.header("Input Example", "blue");
		
    	jui.start();
    }
}
`
	    	
	    	editor.setValue(code);
	        currentFileName = "JUIExample.java";
	         
		}
    window.onload = setDraftCode;
	    
	    
	</script>


<!-- Bootstrap JS and dependencies -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const runButton = document.getElementById('run-btn');
    const saveButton = document.getElementById('save-btn');
    const outputDiv = document.getElementById('console');
    const previewContainer = document.getElementById('preview-container');
    const urlInput = document.getElementById('url-input');
    const openBrowserButton = document.getElementById('open-browser-btn');
    const exampleSelector = document.getElementById('example-selector');
    const consoleDiv = document.getElementById('console');
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('main-content');

    saveButton.addEventListener('click', function () {
        
        const code = editor.getValue();

	  	let fileName;
		if (currentFileName) fileName = currentFileName;
	    else fileName = "CustomCode.java";
		
		fileName = prompt("Inserisci il nome del file da salvare", fileName);  // Altrimenti chiedi all'utente il nome
	
		if (fileName) {
    		fetch('/api/save', {
      			method: 'POST',
      			headers: { 'Content-Type': 'application/json' },
      			body: JSON.stringify({ code, fileName })
    		})
    		.then(response => response.json())
    		.then(data => {
      			outputDiv.innerHTML+= data.message  + "\n";
      			loadExamples();
      			currentFileName = fileName; 
      			runButton.disabled = false; 
    		});
  		}
	});
	
	runButton.addEventListener('click', function () {
      if (!currentFileName) {
        outputDiv.innerHTML  = "Salva prima il file per poterlo eseguire.";
        return;
      }

      outputDiv.innerHTML   = "Il codice sta venendo compilato ed eseguito, attendere prego...";

      // Effettua la richiesta per compilare ed eseguire il codice
      fetch('/api/compile', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ fileName: currentFileName })
      })
      .then(response => {
        if (!response.ok) {
          return response.text().then(errorMessage => {
            throw new Error(errorMessage);
          });
        }
        return response.text();
      })
      .then(output => {
        outputDiv.innerHTML  = output;
        
		// Specifica l'URL della pagina da caricare nell'iframe
	    previewContainer.src = 'http://127.0.0.1:8080/index.html';
	    urlInput.value = 'http://127.0.0.1:8080/index.html';
	    
	  })
      
      .catch(error => {
        // Mostra l'errore nella console di output
        outputDiv.innerHTML  = "Errore durante la compilazione o esecuzione: " + error.message;
      });
    });
    
    // Funzione per caricare un esempio predefinito nel primo editor
    exampleSelector.addEventListener('change', function () {
        const selectedExample = exampleSelector.value;
        if (selectedExample) {
	        loadExampleCode(selectedExample);
        }
    });

    // Funzione per aprire il sito in una nuova finestra del browser
    openBrowserButton.addEventListener('click', function () {
        const url = urlInput.value;
        if (url) {
            window.open(url, '_blank');
        } else {
            alert('Please enter a valid URL');
        }
    });

    // Funzione per mostrare/nascondere la console
    function toggleConsole() {
        if (consoleDiv.style.display === 'block') {
            consoleDiv.style.display = 'none';
            toggleConsoleLink.textContent = 'Hide Console';
        } else {
            consoleDiv.style.display = 'block';
            toggleConsoleLink.textContent = 'Show Console';
        }
    }

    function toggleSidebar() {
    
    	var sidebar = document.getElementById('sidebar');
	    var overlay = document.getElementById('overlay');
	    
	    // Attiva/disattiva la sidebar
	    sidebar.classList.toggle('active');
	    
	    // Mostra/nascondi l'overlay
	    if (sidebar.classList.contains('active')) {
	        overlay.classList.add('active');
	    } else {
	        overlay.classList.remove('active');
	    }
	    
    }
    
</script>

	<script>
    
	    var socket;
	
	    function connectWebSocket() {
	    
	        socket = new WebSocket("ws://localhost:9090/ws");
	        socket.onopen = function () {
	            console.log("Connessione WebSocket aperta.");
	        };
	
	        socket.onmessage = function (event) {
	        	outputDiv.innerHTML+= event.data  + "\n";
	            outputDiv.scrollTop = outputDiv.scrollHeight;
	        };
	
	        socket.onclose = function () {
	            console.log("Connessione WebSocket chiusa.");
	        };
	
	        socket.onerror = function (error) {
	            console.log("Errore WebSocket: " + error);
	        };
	    }
	    
		connectWebSocket();

	</script>

</body>
</html>
